# ğŸš€ SCRAPER DEFINITIVO EXTRAORDINARIO - OCCIDENT PORTAL
## Sistema de ExtracciÃ³n Inteligente Ultra-Avanzado

**VersiÃ³n:** 5.0.0 QUANTUM
**Fecha:** 28 Enero 2026
**Autor:** AIT-CORE Team
**Estado:** DISEÃ‘O DEFINITIVO - CAPACIDADES EXTRAORDINARIAS

---

## ğŸ“‹ ÃNDICE

1. [VisiÃ³n General](#vision-general)
2. [Capacidades del Portal Occident](#capacidades-portal)
3. [Arquitectura del Scraper](#arquitectura)
4. [MÃ³dulos de ExtracciÃ³n](#modulos-extraccion)
5. [Inteligencia Artificial Integrada](#ia-integrada)
6. [IntegraciÃ³n con Ecosistema AIT](#integracion-ait)
7. [Trazabilidad y Monitoreo](#trazabilidad)
8. [Stack TecnolÃ³gico](#stack)
9. [Roadmap de ImplementaciÃ³n](#roadmap)

---

## 1. VISIÃ“N GENERAL {#vision-general}

### ğŸ¯ Objetivo

Crear el **scraper mÃ¡s avanzado jamÃ¡s desarrollado** para el portal de Occident que:

- ğŸ§  **Aprenda y se adapte** automÃ¡ticamente a cambios en el portal
- ğŸ” **Extraiga TODO**: datos visibles, ocultos, generados dinÃ¡micamente, documentos, relaciones
- ğŸ¤– **Use 30 agentes de IA especializados** para tareas especÃ­ficas
- âš¡ **MÃ¡xima velocidad**: procesamiento paralelo distribuido
- ğŸ›¡ï¸ **Anti-detecciÃ³n**: comportamiento humano simulado
- ğŸ”„ **Auto-recuperaciÃ³n**: reintentos inteligentes y aprendizaje de errores
- ğŸ“Š **Trazabilidad completa**: cada byte extraÃ­do estÃ¡ documentado
- ğŸŒ **IntegraciÃ³n total** con el ecosistema AIT-CORE

### ğŸ“Š MÃ©tricas Objetivo

| MÃ©trica | Objetivo | Actual (Base) | Mejora |
|---------|----------|---------------|--------|
| **Clientes/hora** | 500-1000 | 80-100 | **10x** |
| **Datos extraÃ­dos/cliente** | 200+ campos | 45 campos | **4.4x** |
| **Profundidad de navegaciÃ³n** | Nivel 10+ | Nivel 2-3 | **5x** |
| **Documentos descargados** | 100% | 70% | **43%** |
| **PrecisiÃ³n OCR** | 99.5% | 90% | **10.5%** |
| **DetecciÃ³n de cambios** | Tiempo real | Manual | **âˆ** |
| **Tasa de error** | <0.1% | 5-10% | **50-100x** |
| **Tiempo de sincronizaciÃ³n** | 5 min | Manual | **âˆ** |

---

## 2. CAPACIDADES DEL PORTAL OCCIDENT {#capacidades-portal}

### ğŸ¢ Portal: gestiona.occident.es (portaloccident.gco.global)

**Credenciales:**
- Usuario: `b5454085`
- Password: `Bruma01_`

### ğŸ“Š Estructura del Portal (Mapeado Completo)

#### NIVEL 1: SECCIONES PRINCIPALES

```
Portal Occident (Root)
â”œâ”€â”€ ğŸ  INICIO / Dashboard
â”‚   â”œâ”€â”€ Resumen de cartera
â”‚   â”œâ”€â”€ Notificaciones
â”‚   â”œâ”€â”€ Alertas
â”‚   â”œâ”€â”€ EstadÃ­sticas rÃ¡pidas
â”‚   â””â”€â”€ Accesos directos
â”‚
â”œâ”€â”€ ğŸ‘¥ CLIENTES
â”‚   â”œâ”€â”€ BÃºsqueda de clientes
â”‚   â”œâ”€â”€ Listado de clientes
â”‚   â”œâ”€â”€ Crear nuevo cliente
â”‚   â””â”€â”€ [POR CADA CLIENTE] â†’
â”‚       â”œâ”€â”€ ğŸ“‹ Datos personales
â”‚       â”‚   â”œâ”€â”€ InformaciÃ³n bÃ¡sica
â”‚       â”‚   â”œâ”€â”€ Documentos de identidad
â”‚       â”‚   â”œâ”€â”€ Datos de contacto
â”‚       â”‚   â”œâ”€â”€ Direcciones
â”‚       â”‚   â”œâ”€â”€ Beneficiarios
â”‚       â”‚   â””â”€â”€ Relaciones familiares
â”‚       â”‚
â”‚       â”œâ”€â”€ ğŸ“„ PÃ“LIZAS (Lista completa)
â”‚       â”‚   â””â”€â”€ [POR CADA PÃ“LIZA] â†’
â”‚       â”‚       â”œâ”€â”€ Datos de la pÃ³liza
â”‚       â”‚       â”‚   â”œâ”€â”€ NÃºmero de pÃ³liza
â”‚       â”‚       â”‚   â”œâ”€â”€ Producto
â”‚       â”‚       â”‚   â”œâ”€â”€ Vigencia (inicio/fin)
â”‚       â”‚       â”‚   â”œâ”€â”€ Prima
â”‚       â”‚       â”‚   â”œâ”€â”€ Forma de pago
â”‚       â”‚       â”‚   â”œâ”€â”€ Estado
â”‚       â”‚       â”‚   â””â”€â”€ Observaciones
â”‚       â”‚       â”‚
â”‚       â”‚       â”œâ”€â”€ Coberturas
â”‚       â”‚       â”‚   â”œâ”€â”€ Coberturas contratadas
â”‚       â”‚       â”‚   â”œâ”€â”€ LÃ­mites de cada cobertura
â”‚       â”‚       â”‚   â”œâ”€â”€ Franquicias
â”‚       â”‚       â”‚   â”œâ”€â”€ Exclusiones
â”‚       â”‚       â”‚   â””â”€â”€ Condiciones especiales
â”‚       â”‚       â”‚
â”‚       â”‚       â”œâ”€â”€ Asegurados/Objetos
â”‚       â”‚       â”‚   â”œâ”€â”€ [AUTOS] â†’
â”‚       â”‚       â”‚   â”‚   â”œâ”€â”€ MatrÃ­cula
â”‚       â”‚       â”‚   â”‚   â”œâ”€â”€ Marca y modelo
â”‚       â”‚       â”‚   â”‚   â”œâ”€â”€ AÃ±o
â”‚       â”‚       â”‚   â”‚   â”œâ”€â”€ Valor
â”‚       â”‚       â”‚   â”‚   â”œâ”€â”€ Uso
â”‚       â”‚       â”‚   â”‚   â””â”€â”€ Conductor habitual
â”‚       â”‚       â”‚   â”‚
â”‚       â”‚       â”‚   â”œâ”€â”€ [HOGAR] â†’
â”‚       â”‚       â”‚   â”‚   â”œâ”€â”€ DirecciÃ³n completa
â”‚       â”‚       â”‚   â”‚   â”œâ”€â”€ Tipo de vivienda
â”‚       â”‚       â”‚   â”‚   â”œâ”€â”€ Superficie
â”‚       â”‚       â”‚   â”‚   â”œâ”€â”€ Valor continente
â”‚       â”‚       â”‚   â”‚   â”œâ”€â”€ Valor contenido
â”‚       â”‚       â”‚   â”‚   â””â”€â”€ Medidas de seguridad
â”‚       â”‚       â”‚   â”‚
â”‚       â”‚       â”‚   â”œâ”€â”€ [VIDA/SALUD] â†’
â”‚       â”‚       â”‚   â”‚   â”œâ”€â”€ Datos del asegurado
â”‚       â”‚       â”‚   â”‚   â”œâ”€â”€ Cuestionario de salud
â”‚       â”‚       â”‚   â”‚   â”œâ”€â”€ Capitales asegurados
â”‚       â”‚       â”‚   â”‚   â””â”€â”€ Beneficiarios
â”‚       â”‚       â”‚   â”‚
â”‚       â”‚       â”‚   â””â”€â”€ [OTROS PRODUCTOS]
â”‚       â”‚       â”‚
â”‚       â”‚       â”œâ”€â”€ Suplementos/Endosos
â”‚       â”‚       â”‚   â”œâ”€â”€ Historial de modificaciones
â”‚       â”‚       â”‚   â”œâ”€â”€ Suplementos de prima
â”‚       â”‚       â”‚   â”œâ”€â”€ Cambios de cobertura
â”‚       â”‚       â”‚   â””â”€â”€ Documentos asociados
â”‚       â”‚       â”‚
â”‚       â”‚       â”œâ”€â”€ DocumentaciÃ³n
â”‚       â”‚       â”‚   â”œâ”€â”€ PÃ³liza original (PDF)
â”‚       â”‚       â”‚   â”œâ”€â”€ Condiciones particulares
â”‚       â”‚       â”‚   â”œâ”€â”€ Condiciones generales
â”‚       â”‚       â”‚   â”œâ”€â”€ Suplementos
â”‚       â”‚       â”‚   â”œâ”€â”€ Certificados de seguro
â”‚       â”‚       â”‚   â””â”€â”€ Anexos
â”‚       â”‚       â”‚
â”‚       â”‚       â””â”€â”€ Historial
â”‚       â”‚           â”œâ”€â”€ Cambios de estado
â”‚       â”‚           â”œâ”€â”€ Modificaciones
â”‚       â”‚           â”œâ”€â”€ Renovaciones
â”‚       â”‚           â””â”€â”€ Anulaciones
â”‚       â”‚
â”‚       â”œâ”€â”€ ğŸš¨ SINIESTROS
â”‚       â”‚   â””â”€â”€ [POR CADA SINIESTRO] â†’
â”‚       â”‚       â”œâ”€â”€ Datos del siniestro
â”‚       â”‚       â”‚   â”œâ”€â”€ NÃºmero de expediente
â”‚       â”‚       â”‚   â”œâ”€â”€ PÃ³liza afectada
â”‚       â”‚       â”‚   â”œâ”€â”€ Fecha del siniestro
â”‚       â”‚       â”‚   â”œâ”€â”€ Fecha de apertura
â”‚       â”‚       â”‚   â”œâ”€â”€ Tipo de siniestro
â”‚       â”‚       â”‚   â”œâ”€â”€ DescripciÃ³n
â”‚       â”‚       â”‚   â”œâ”€â”€ Lugar
â”‚       â”‚       â”‚   â””â”€â”€ Circunstancias
â”‚       â”‚       â”‚
â”‚       â”‚       â”œâ”€â”€ Personas involucradas
â”‚       â”‚       â”‚   â”œâ”€â”€ Declarante
â”‚       â”‚       â”‚   â”œâ”€â”€ Afectados
â”‚       â”‚       â”‚   â”œâ”€â”€ Testigos
â”‚       â”‚       â”‚   â””â”€â”€ Terceros implicados
â”‚       â”‚       â”‚
â”‚       â”‚       â”œâ”€â”€ DaÃ±os declarados
â”‚       â”‚       â”‚   â”œâ”€â”€ DescripciÃ³n de daÃ±os
â”‚       â”‚       â”‚   â”œâ”€â”€ ValoraciÃ³n inicial
â”‚       â”‚       â”‚   â”œâ”€â”€ Peritaje
â”‚       â”‚       â”‚   â””â”€â”€ ValoraciÃ³n final
â”‚       â”‚       â”‚
â”‚       â”‚       â”œâ”€â”€ TramitaciÃ³n
â”‚       â”‚       â”‚   â”œâ”€â”€ Estado actual
â”‚       â”‚       â”‚   â”œâ”€â”€ Perito asignado
â”‚       â”‚       â”‚   â”œâ”€â”€ Fechas clave
â”‚       â”‚       â”‚   â”œâ”€â”€ ResoluciÃ³n
â”‚       â”‚       â”‚   â”œâ”€â”€ Importe reconocido
â”‚       â”‚       â”‚   â””â”€â”€ Observaciones
â”‚       â”‚       â”‚
â”‚       â”‚       â”œâ”€â”€ DocumentaciÃ³n
â”‚       â”‚       â”‚   â”œâ”€â”€ Parte de declaraciÃ³n
â”‚       â”‚       â”‚   â”œâ”€â”€ Fotos de daÃ±os
â”‚       â”‚       â”‚   â”œâ”€â”€ Informes periciales
â”‚       â”‚       â”‚   â”œâ”€â”€ Facturas de reparaciÃ³n
â”‚       â”‚       â”‚   â”œâ”€â”€ Partes de atestado
â”‚       â”‚       â”‚   â”œâ”€â”€ Informes mÃ©dicos
â”‚       â”‚       â”‚   â””â”€â”€ Correspondencia
â”‚       â”‚       â”‚
â”‚       â”‚       â”œâ”€â”€ Pagos
â”‚       â”‚       â”‚   â”œâ”€â”€ Provisiones
â”‚       â”‚       â”‚   â”œâ”€â”€ Pagos efectuados
â”‚       â”‚       â”‚   â”œâ”€â”€ Pagos pendientes
â”‚       â”‚       â”‚   â””â”€â”€ Regularizaciones
â”‚       â”‚       â”‚
â”‚       â”‚       â””â”€â”€ Historial
â”‚       â”‚           â”œâ”€â”€ Log de acciones
â”‚       â”‚           â”œâ”€â”€ Comunicaciones
â”‚       â”‚           â””â”€â”€ Cambios de estado
â”‚       â”‚
â”‚       â”œâ”€â”€ ğŸ’° RECIBOS
â”‚       â”‚   â””â”€â”€ [POR CADA RECIBO] â†’
â”‚       â”‚       â”œâ”€â”€ Datos del recibo
â”‚       â”‚       â”‚   â”œâ”€â”€ NÃºmero de recibo
â”‚       â”‚       â”‚   â”œâ”€â”€ PÃ³liza asociada
â”‚       â”‚       â”‚   â”œâ”€â”€ Importe
â”‚       â”‚       â”‚   â”œâ”€â”€ Fecha de vencimiento
â”‚       â”‚       â”‚   â”œâ”€â”€ Forma de pago
â”‚       â”‚       â”‚   â”œâ”€â”€ Estado (pagado/pendiente/impagado)
â”‚       â”‚       â”‚   â””â”€â”€ Observaciones
â”‚       â”‚       â”‚
â”‚       â”‚       â”œâ”€â”€ Desglose
â”‚       â”‚       â”‚   â”œâ”€â”€ Prima neta
â”‚       â”‚       â”‚   â”œâ”€â”€ Consorcio
â”‚       â”‚       â”‚   â”œâ”€â”€ Impuestos
â”‚       â”‚       â”‚   â”œâ”€â”€ Recargos
â”‚       â”‚       â”‚   â””â”€â”€ Prima total
â”‚       â”‚       â”‚
â”‚       â”‚       â”œâ”€â”€ Pagos
â”‚       â”‚       â”‚   â”œâ”€â”€ Fecha de pago
â”‚       â”‚       â”‚   â”œâ”€â”€ MÃ©todo de pago
â”‚       â”‚       â”‚   â”œâ”€â”€ Referencia bancaria
â”‚       â”‚       â”‚   â””â”€â”€ Justificante
â”‚       â”‚       â”‚
â”‚       â”‚       â””â”€â”€ Documentos
â”‚       â”‚           â”œâ”€â”€ Recibo (PDF)
â”‚       â”‚           â””â”€â”€ Justificante de pago
â”‚       â”‚
â”‚       â”œâ”€â”€ ğŸ’¬ COMUNICACIONES
â”‚       â”‚   â”œâ”€â”€ Historial de emails
â”‚       â”‚   â”œâ”€â”€ Llamadas registradas
â”‚       â”‚   â”œâ”€â”€ SMS enviados
â”‚       â”‚   â”œâ”€â”€ WhatsApp (si integrado)
â”‚       â”‚   â””â”€â”€ Notas internas
â”‚       â”‚
â”‚       â”œâ”€â”€ ğŸ“ DOCUMENTOS GENERALES
â”‚       â”‚   â”œâ”€â”€ DNI/NIE/Pasaporte
â”‚       â”‚   â”œâ”€â”€ Permiso de conducir
â”‚       â”‚   â”œâ”€â”€ Escrituras
â”‚       â”‚   â”œâ”€â”€ Contratos
â”‚       â”‚   â”œâ”€â”€ Poderes
â”‚       â”‚   â””â”€â”€ Otros documentos
â”‚       â”‚
â”‚       â”œâ”€â”€ ğŸ“ˆ ESTADÃSTICAS
â”‚       â”‚   â”œâ”€â”€ Volumen de primas
â”‚       â”‚   â”œâ”€â”€ NÃºmero de pÃ³lizas
â”‚       â”‚   â”œâ”€â”€ Siniestralidad
â”‚       â”‚   â”œâ”€â”€ Ratio combinado
â”‚       â”‚   â””â”€â”€ Tendencias
â”‚       â”‚
â”‚       â””â”€â”€ ğŸ”” ALERTAS/AVISOS
â”‚           â”œâ”€â”€ PrÃ³ximos vencimientos
â”‚           â”œâ”€â”€ Recibos impagados
â”‚           â”œâ”€â”€ DocumentaciÃ³n pendiente
â”‚           â”œâ”€â”€ Renovaciones prÃ³ximas
â”‚           â””â”€â”€ Acciones requeridas
â”‚
â”œâ”€â”€ ğŸ“Š INFORMES Y ESTADÃSTICAS
â”‚   â”œâ”€â”€ ProducciÃ³n
â”‚   â”œâ”€â”€ Cartera
â”‚   â”œâ”€â”€ Siniestralidad
â”‚   â”œâ”€â”€ Comisiones
â”‚   â”œâ”€â”€ Renovaciones
â”‚   â””â”€â”€ Informes personalizados
â”‚
â”œâ”€â”€ ğŸ’¼ GESTIÃ“N DE CARTERA
â”‚   â”œâ”€â”€ Resumen de cartera
â”‚   â”œâ”€â”€ PÃ³lizas en vigor
â”‚   â”œâ”€â”€ PÃ³lizas anuladas
â”‚   â”œâ”€â”€ Renovaciones pendientes
â”‚   â””â”€â”€ PrÃ³ximos vencimientos
â”‚
â”œâ”€â”€ ğŸ’µ COMISIONES
â”‚   â”œâ”€â”€ Liquidaciones
â”‚   â”œâ”€â”€ Extractos de comisiones
â”‚   â”œâ”€â”€ Detalle por pÃ³liza
â”‚   â”œâ”€â”€ HistÃ³rico
â”‚   â””â”€â”€ Pendientes de pago
â”‚
â”œâ”€â”€ ğŸ“¨ MENSAJERÃA
â”‚   â”œâ”€â”€ Bandeja de entrada
â”‚   â”œâ”€â”€ Mensajes enviados
â”‚   â”œâ”€â”€ Notificaciones del sistema
â”‚   â””â”€â”€ Comunicaciones con compaÃ±Ã­a
â”‚
â”œâ”€â”€ âš™ï¸ CONFIGURACIÃ“N
â”‚   â”œâ”€â”€ Datos del mediador
â”‚   â”œâ”€â”€ Oficinas
â”‚   â”œâ”€â”€ Usuarios
â”‚   â”œâ”€â”€ Permisos
â”‚   â””â”€â”€ Preferencias
â”‚
â””â”€â”€ ğŸ“š AYUDA Y RECURSOS
    â”œâ”€â”€ Manuales
    â”œâ”€â”€ Tutoriales
    â”œâ”€â”€ Preguntas frecuentes
    â””â”€â”€ Soporte tÃ©cnico
```

---

## 3. ARQUITECTURA DEL SCRAPER {#arquitectura}

### ğŸ—ï¸ Arquitectura General

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     SCRAPER QUANTUM DEFINITIVO                       â”‚
â”‚                      (Arquitectura Multi-Layer)                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚                               â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  CAPA DE ORQUESTACIÃ“Nâ”‚      â”‚  CAPA DE INTELIGENCIA â”‚
    â”‚   (n8n + Director)   â”‚      â”‚   (30 Agentes IA)     â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚                               â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚            CAPA DE DESCUBRIMIENTO                      â”‚
    â”‚  â€¢ Auto-mapeo del portal                               â”‚
    â”‚  â€¢ DetecciÃ³n de cambios de UI                          â”‚
    â”‚  â€¢ GeneraciÃ³n dinÃ¡mica de selectores                   â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚           CAPA DE NAVEGACIÃ“N Y EXTRACCIÃ“N              â”‚
    â”‚  â€¢ Playwright Multi-Browser (5-10 paralelos)           â”‚
    â”‚  â€¢ Anti-detecciÃ³n (comportamiento humano)              â”‚
    â”‚  â€¢ GestiÃ³n de sesiones                                 â”‚
    â”‚  â€¢ CaptaciÃ³n de Network Requests                       â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚                   â”‚                   â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  PROCESAMIENTO  â”‚ â”‚  PROCESAMIENTO â”‚ â”‚  PROCESAMIENTO â”‚
â”‚   VISUAL (OCR)  â”‚ â”‚  NLP/ENTIDADES â”‚ â”‚  DOCUMENTOS    â”‚
â”‚  â€¢ Tesseract    â”‚ â”‚  â€¢ spaCy       â”‚ â”‚  â€¢ PyPDF2      â”‚
â”‚  â€¢ EasyOCR      â”‚ â”‚  â€¢ BERT        â”‚ â”‚  â€¢ Tika        â”‚
â”‚  â€¢ OpenCV       â”‚ â”‚  â€¢ GPT-4       â”‚ â”‚  â€¢ pandoc      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                   â”‚                   â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚              CAPA DE VALIDACIÃ“N Y LIMPIEZA             â”‚
    â”‚  â€¢ ValidaciÃ³n de datos con Pydantic                    â”‚
    â”‚  â€¢ NormalizaciÃ³n de formatos                           â”‚
    â”‚  â€¢ DeduplicaciÃ³n inteligente                           â”‚
    â”‚  â€¢ Enriquecimiento con datos externos                  â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚            CAPA DE PERSISTENCIA Y EVENTOS              â”‚
    â”‚  â€¢ PostgreSQL (datos estructurados)                    â”‚
    â”‚  â€¢ MongoDB (logs y datos no estructurados)             â”‚
    â”‚  â€¢ S3/MinIO (documentos)                               â”‚
    â”‚  â€¢ Elasticsearch (bÃºsqueda)                            â”‚
    â”‚  â€¢ Redis (cachÃ© y cola)                                â”‚
    â”‚  â€¢ RabbitMQ (eventos)                                  â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚          CAPA DE INTEGRACIÃ“N CON ECOSISTEMA            â”‚
    â”‚  â€¢ API Gateway (Kong)                                  â”‚
    â”‚  â€¢ WebSockets (Real-time)                              â”‚
    â”‚  â€¢ GraphQL (consultas flexibles)                       â”‚
    â”‚  â€¢ Webhooks (notificaciones)                           â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 4. MÃ“DULOS DE EXTRACCIÃ“N {#modulos-extraccion}

### ğŸ“¦ Sistema Modular con 15 Extractores Especializados

#### 4.1. **EXTRACTOR CORE - Orquestador Principal**

**Responsabilidades:**
- Coordinar todos los extractores
- Gestionar la cola de trabajo
- Distribuir carga entre workers
- Monitorear salud del sistema
- Recolectar mÃ©tricas

**TecnologÃ­as:**
- Python 3.12+ con asyncio
- Celery para tareas distribuidas
- Redis como broker
- Prometheus para mÃ©tricas

---

#### 4.2. **EXTRACTOR DE CLIENTES** ğŸ§‘â€ğŸ’¼

**Datos a extraer (50+ campos):**

```python
ClienteCompleto = {
    # IdentificaciÃ³n
    "nif": str,
    "tipo_documento": Literal["NIF", "NIE", "CIF", "PASAPORTE"],
    "nombre": str,
    "apellido1": str,
    "apellido2": str,
    "nombre_completo": str,
    "razon_social": str | None,  # Para empresas
    "nombre_comercial": str | None,

    # Datos personales
    "fecha_nacimiento": date,
    "edad": int,
    "sexo": Literal["M", "F", "OTRO"],
    "estado_civil": str,
    "nacionalidad": str,
    "pais_nacimiento": str,
    "provincia_nacimiento": str,
    "localidad_nacimiento": str,

    # Contacto (mÃºltiple)
    "telefonos": List[{
        "tipo": Literal["FIJO", "MOVIL", "TRABAJO"],
        "numero": str,
        "extension": str | None,
        "principal": bool,
        "verificado": bool,
    }],

    "emails": List[{
        "email": str,
        "tipo": Literal["PERSONAL", "TRABAJO", "OTRO"],
        "principal": bool,
        "verificado": bool,
    }],

    # Direcciones (mÃºltiple)
    "direcciones": List[{
        "tipo": Literal["HABITUAL", "FISCAL", "TRABAJO", "OTRA"],
        "calle": str,
        "numero": str,
        "piso": str | None,
        "puerta": str | None,
        "codigo_postal": str,
        "localidad": str,
        "provincia": str,
        "pais": str,
        "coordenadas": {"lat": float, "lon": float} | None,
        "principal": bool,
    }],

    # InformaciÃ³n bancaria
    "cuentas_bancarias": List[{
        "iban": str,
        "banco": str,
        "sucursal": str | None,
        "tipo": Literal["DOMICILIACION", "TRANSFERENCIA"],
        "principal": bool,
    }],

    # Profesional
    "profesion": str,
    "actividad_economica": str,
    "cnae": str | None,
    "situacion_laboral": str,
    "empresa": str | None,

    # Familiar
    "estado_familiar": {
        "conyuge": {"nombre": str, "nif": str} | None,
        "hijos": List[{"nombre": str, "fecha_nacimiento": date}],
        "personas_a_cargo": int,
    },

    # Beneficiarios
    "beneficiarios": List[{
        "nombre": str,
        "nif": str,
        "parentesco": str,
        "porcentaje": int,
        "tipo_beneficiario": Literal["IRREVOCABLE", "REVOCABLE"],
    }],

    # Metadatos
    "fecha_alta": datetime,
    "fecha_ultima_modificacion": datetime,
    "origen_cliente": str,
    "codigo_mediador": str,
    "oficina": str,
    "comercial_asignado": str | None,
    "segmento": str,
    "puntuacion_riesgo": int | None,
    "valor_cartera": Decimal,

    # Relaciones
    "relaciones": List[{
        "nif_relacionado": str,
        "tipo_relacion": Literal["CONYUGE", "HIJO", "PADRE", "MADRE", "HERMANO", "SOCIO", "APODERADO"],
    }],

    # Preferencias
    "preferencias_comunicacion": {
        "canal_preferido": Literal["EMAIL", "TELEFONO", "SMS", "WHATSAPP", "CORREO_POSTAL"],
        "horario_contacto": str,
        "idioma": str,
        "marketing": bool,
    },

    # DocumentaciÃ³n
    "documentos": List[{
        "tipo": str,
        "nombre_archivo": str,
        "url_s3": str,
        "fecha_subida": datetime,
        "tamano": int,
    }],

    # Observaciones
    "notas": List[{
        "fecha": datetime,
        "usuario": str,
        "categoria": str,
        "texto": str,
    }],

    # EstadÃ­sticas
    "estadisticas": {
        "num_polizas_activas": int,
        "num_polizas_historicas": int,
        "num_siniestros": int,
        "volumen_primas_anual": Decimal,
        "antiguedad_cliente_dias": int,
        "ratio_siniestralidad": float,
    },
}
```

**Estrategia de extracciÃ³n:**
1. Buscar cliente por NIF
2. Acceder a ficha completa
3. Navegar por TODAS las pestaÃ±as/secciones
4. Extraer datos visibles + capturar requests JSON de APIs
5. Descargar TODOS los documentos asociados
6. Aplicar OCR a imÃ¡genes de documentos
7. Extraer entidades con NLP
8. Validar y normalizar datos
9. Guardar en BD + S3 + Elasticsearch

---

#### 4.3. **EXTRACTOR DE PÃ“LIZAS** ğŸ“„

**Datos a extraer (80+ campos por pÃ³liza):**

```python
PolizaCompleta = {
    # IdentificaciÃ³n
    "numero_poliza": str,
    "codigo_interno": str | None,
    "producto": str,
    "ramo": str,
    "sub_ramo": str | None,
    "modalidad": str,

    # Vigencia
    "fecha_efecto": date,
    "fecha_vencimiento": date,
    "duracion_meses": int,
    "estado": Literal["ACTIVA", "ANULADA", "VENCIDA", "SUSPENDIDA", "EN_TRAMITE"],
    "motivo_estado": str | None,

    # EconÃ³micos
    "prima_neta": Decimal,
    "recargo_fraccionamiento": Decimal,
    "consorcio": Decimal,
    "impuestos": Decimal,
    "prima_total": Decimal,
    "forma_pago": Literal["MENSUAL", "TRIMESTRAL", "SEMESTRAL", "ANUAL"],
    "medio_pago": Literal["DOMICILIACION", "TRANSFERENCIA", "TARJETA", "EFECTIVO"],

    # Partes
    "tomador": {"nif": str, "nombre": str},
    "asegurado": {"nif": str, "nombre": str},
    "pagador": {"nif": str, "nombre": str} | None,

    # Riesgo (Variable segÃºn tipo)
    "objeto_asegurado": Dict[str, Any],  # Ver estructura especÃ­fica por producto

    # Coberturas
    "coberturas": List[{
        "codigo": str,
        "nombre": str,
        "descripcion": str,
        "capital": Decimal,
        "prima": Decimal,
        "franquicia": Decimal | None,
        "tipo_franquicia": str | None,
        "obligatoria": bool,
        "exclusiones": List[str],
    }],

    # Suplementos
    "suplementos": List[{
        "numero": int,
        "fecha": date,
        "tipo": str,
        "descripcion": str,
        "efecto_prima": Decimal,
        "documentos": List[str],
    }],

    # Agentes
    "mediador": {
        "codigo": str,
        "nombre": str,
        "comision_porcentaje": float,
    },

    # DocumentaciÃ³n
    "documentos": List[{
        "tipo": Literal["POLIZA", "CONDICIONES_PARTICULARES", "CONDICIONES_GENERALES", "SUPLEMENTO", "CERTIFICADO"],
        "nombre_archivo": str,
        "url_s3": str,
        "fecha_emision": date,
    }],

    # RenovaciÃ³n
    "renovacion_automatica": bool,
    "fecha_aviso_renovacion": date | None,
    "poliza_anterior": str | None,
    "poliza_renovacion": str | None,

    # Observaciones
    "observaciones": str | None,
    "clausulas_especiales": List[str],

    # Metadatos
    "fecha_emision": datetime,
    "usuario_emision": str,
    "fecha_ultima_modificacion": datetime,
    "canal_venta": str,
    "campana": str | None,

    # EstadÃ­sticas
    "estadisticas": {
        "num_suplementos": int,
        "num_recibos_emitidos": int,
        "num_recibos_pagados": int,
        "num_recibos_impagados": int,
        "num_siniestros": int,
        "total_indemnizado": Decimal,
        "ratio_siniestralidad": float,
    },
}

# ESTRUCTURAS ESPECÃFICAS POR PRODUCTO

# AUTOS
ObjetoAuto = {
    "matricula": str,
    "bastidor": str,
    "marca": str,
    "modelo": str,
    "version": str | None,
    "fecha_matriculacion": date,
    "potencia_fiscal": int,
    "potencia_cv": int,
    "combustible": Literal["GASOLINA", "DIESEL", "ELECTRICO", "HIBRIDO", "GLP", "HIDROGENO"],
    "valor_vehiculo": Decimal,
    "valor_nuevo": Decimal,
    "uso": Literal["PARTICULAR", "TRABAJO", "MIXTO", "TAXI", "VTC", "ALQUILER"],
    "km_anuales": int,
    "garaje": bool,
    "codigo_postal_pernocta": str,
    "conductor_habitual": {"nif": str, "nombre": str, "fecha_permiso": date},
    "conductores_adicionales": List[{"nif": str, "nombre": str}],
    "antecedentes": {"siniestros_3_anos": int, "reclamaciones": int},
}

# HOGAR
ObjetoHogar = {
    "direccion": str,
    "tipo_vivienda": Literal["PISO", "CHALET", "ADOSADO", "DUPLEX", "ESTUDIO", "ATICO"],
    "regimen": Literal["PROPIEDAD", "ALQUILER", "USUFRUCTO"],
    "superficie_construida": int,
    "superficie_util": int,
    "numero_habitaciones": int,
    "numero_banos": int,
    "ano_construccion": int,
    "estado_conservacion": str,
    "uso": Literal["HABITUAL", "SEGUNDA_RESIDENCIA", "ALQUILER_VACACIONAL"],
    "habitantes": int,
    "valor_continente": Decimal,
    "valor_contenido": Decimal,
    "medidas_seguridad": List[Literal["PUERTA_BLINDADA", "ALARMA", "REJAS", "VIDEO", "CERRADURAS_SEGURIDAD"]],
    "siniestros_5_anos": List[{"fecha": date, "tipo": str, "importe": Decimal}],
}

# VIDA/SALUD
ObjetoVida = {
    "cuestionario_salud": {
        "altura": int,  # cm
        "peso": int,  # kg
        "imc": float,
        "fuma": bool,
        "cigarrillos_dia": int | None,
        "consume_alcohol": bool,
        "unidades_semana": int | None,
        "practica_deportes_riesgo": bool,
        "deportes": List[str],
        "enfermedades_preexistentes": List[str],
        "cirugias": List[{"fecha": date, "tipo": str}],
        "medicacion_habitual": List[str],
        "hospitalizaciones_5_anos": int,
        "bajas_laborales_3_anos": int,
    },
    "capital_fallecimiento": Decimal,
    "capital_invalidez": Decimal,
    "capitales_adicionales": Dict[str, Decimal],
}
```

**Estrategia de extracciÃ³n:**
1. Obtener lista completa de pÃ³lizas del cliente
2. Para cada pÃ³liza:
   - Acceder a detalle completo
   - Extraer datos de TODAS las pestaÃ±as
   - Identificar tipo de producto
   - Aplicar parser especÃ­fico
   - Descargar documentos PDF
   - Extraer texto de PDFs con OCR si es necesario
   - Capturar calls a API
3. Detectar relaciones entre pÃ³lizas
4. Calcular estadÃ­sticas agregadas
5. Validar consistencia de datos

---

#### 4.4. **EXTRACTOR DE SINIESTROS** ğŸš¨

**Datos a extraer (70+ campos por siniestro):**

```python
SiniestroCompleto = {
    # IdentificaciÃ³n
    "numero_expediente": str,
    "numero_poliza": str,
    "tipo_siniestro": str,
    "sub_tipo": str | None,

    # Fechas crÃ­ticas
    "fecha_siniestro": datetime,
    "fecha_apertura": datetime,
    "fecha_asignacion_perito": datetime | None,
    "fecha_peritacion": datetime | None,
    "fecha_resolucion": datetime | None,
    "fecha_pago": datetime | None,
    "fecha_cierre": datetime | None,

    # Estado y tramitaciÃ³n
    "estado": Literal["ABIERTO", "EN_TRAMITE", "PERITADO", "RESUELTO", "PAGADO", "CERRADO", "RECHAZADO"],
    "perito_asignado": {"codigo": str, "nombre": str, "empresa": str} | None,
    "tramitador": {"codigo": str, "nombre": str} | None,

    # Circunstancias
    "lugar_siniestro": {
        "direccion": str,
        "codigo_postal": str,
        "localidad": str,
        "provincia": str,
        "coordenadas": {"lat": float, "lon": float} | None,
    },
    "descripcion": str,
    "causas": List[str],
    "circunstancias_detalladas": str,
    "condiciones_meteorologicas": str | None,

    # Personas involucradas
    "declarante": {"nif": str, "nombre": str, "telefono": str},
    "afectados": List[{
        "nif": str,
        "nombre": str,
        "rol": Literal["TOMADOR", "ASEGURADO", "CONDUCTOR", "PEATÃ“N", "PASAJERO"],
        "lesiones": str | None,
    }],
    "terceros": List[{
        "nif": str | None,
        "nombre": str,
        "aseguradora": str | None,
        "num_poliza": str | None,
        "rol": str,
    }],
    "testigos": List[{"nombre": str, "telefono": str}],

    # DaÃ±os
    "danos_declarados": List[{
        "tipo": str,
        "descripcion": str,
        "valoracion_inicial": Decimal | None,
    }],

    # PeritaciÃ³n
    "peritaje": {
        "fecha": datetime | None,
        "tipo": Literal["DOMICILIARIO", "GABINETE", "JUDICIAL"],
        "valoracion": Decimal | None,
        "dictamen": str | None,
        "recomendaciones": str | None,
    },

    # ResoluciÃ³n
    "resolucion": {
        "tipo": Literal["FAVORABLE", "DESFAVORABLE", "PARCIAL"],
        "importe_reconocido": Decimal,
        "importe_franquicia": Decimal,
        "importe_neto_pagar": Decimal,
        "fundamentos": str,
        "coberturas_aplicadas": List[str],
    },

    # Pagos
    "pagos": List[{
        "fecha": date,
        "tipo": Literal["PROVISION", "PAGO_DEFINITIVO", "REGULARIZACION"],
        "importe": Decimal,
        "beneficiario": str,
        "metodo": str,
        "referencia": str | None,
    }],

    # Regreso/SubrogaciÃ³n
    "regreso": {
        "existe": bool,
        "responsable": str | None,
        "aseguradora_responsable": str | None,
        "importe_reclamado": Decimal | None,
        "importe_recuperado": Decimal | None,
        "estado": str | None,
    },

    # DocumentaciÃ³n
    "documentos": List[{
        "tipo": Literal["PARTE", "FOTO", "PRESUPUESTO", "FACTURA", "PERITAJE", "INFORME_MEDICO", "ATESTADO", "CORRESPONDENCIA"],
        "nombre_archivo": str,
        "url_s3": str,
        "fecha_subida": datetime,
    }],

    # Comunicaciones
    "comunicaciones": List[{
        "fecha": datetime,
        "canal": Literal["EMAIL", "TELEFONO", "PRESENCIAL", "CORREO"],
        "remitente": str,
        "destinatario": str,
        "asunto": str,
        "contenido": str,
    }],

    # Historial
    "historial": List[{
        "fecha": datetime,
        "usuario": str,
        "accion": str,
        "detalles": str,
    }],

    # Metadatos
    "mediador_gestor": str,
    "oficina": str,
    "complejidad": Literal["BAJA", "MEDIA", "ALTA"],
    "prioridad": Literal["NORMAL", "URGENTE", "CRITICA"],
    "tiempo_resolucion_dias": int | None,
}
```

**Estrategia de extracciÃ³n:**
1. Listar todos los siniestros del cliente
2. Para cada siniestro:
   - Extraer datos principales
   - Navegar a detalle completo
   - Extraer personas involucradas
   - Extraer daÃ±os y peritaje
   - Extraer resoluciÃ³n y pagos
   - Descargar TODOS los documentos
   - Aplicar OCR a fotos de daÃ±os
   - Extraer informaciÃ³n de atestados con NLP
3. Detectar patrones de fraude con ML
4. Calcular mÃ©tricas de tramitaciÃ³n

---

#### 4.5. **EXTRACTOR DE RECIBOS** ğŸ’°

**Datos a extraer (40+ campos por recibo):**

```python
ReciboCompleto = {
    # IdentificaciÃ³n
    "numero_recibo": str,
    "numero_poliza": str,
    "periodo": int,  # 1, 2, 3... segÃºn fraccionamiento

    # Importes
    "prima_neta": Decimal,
    "recargo_fraccionamiento": Decimal,
    "consorcio": Decimal,
    "ips": Decimal,  # Impuesto sobre primas de seguros
    "lea": Decimal,  # LiquidaciÃ³n Entidades Aseguradoras (si aplica)
    "prima_total": Decimal,

    # Fechas
    "fecha_emision": date,
    "fecha_efecto": date,
    "fecha_vencimiento": date,
    "fecha_cargo": date | None,
    "fecha_pago": date | None,

    # Estado y pago
    "estado": Literal["PENDIENTE", "PAGADO", "IMPAGADO", "ANULADO", "DEVUELTO"],
    "metodo_pago": Literal["DOMICILIACION", "TRANSFERENCIA", "TARJETA", "EFECTIVO", "OTROS"],
    "cuenta_cargo": str | None,  # IBAN
    "referencia_pago": str | None,
    "codigo_devolucion": str | None,
    "motivo_devolucion": str | None,

    # DevoluciÃ³n/Complementario
    "tipo": Literal["NORMAL", "COMPLEMENTARIO", "DEVOLUCION"],
    "recibo_complementa": str | None,
    "importe_anterior": Decimal | None,
    "diferencia": Decimal | None,

    # DocumentaciÃ³n
    "justificante_url": str | None,
    "recibo_pdf_url": str | None,

    # Observaciones
    "observaciones": str | None,
    "gestiones": List[{
        "fecha": datetime,
        "usuario": str,
        "accion": Literal["EMISION", "ENVIO", "CARGO", "DEVOLUCION", "REENVIO", "ANULACION"],
        "comentario": str | None,
    }],
}
```

**Estrategia de extracciÃ³n:**
1. Obtener lista completa de recibos de cada pÃ³liza
2. Filtrar por estados
3. Extraer datos completos
4. Descargar justificantes de pago
5. Calcular mÃ©tricas de cobro
6. Detectar patrones de impago

---

#### 4.6. **EXTRACTOR DE COMISIONES** ğŸ’µ

**Datos a extraer:**

```python
ComisionCompleta = {
    "periodo": {"aÃ±o": int, "mes": int} | {"aÃ±o": int, "trimestre": int},
    "mediador": {"codigo": str, "nombre": str},
    "detalle_polizas": List[{
        "numero_poliza": str,
        "producto": str,
        "tipo_operacion": Literal["NUEVA_PRODUCCION", "RENOVACION", "SUPLEMENTO"],
        "prima_neta": Decimal,
        "porcentaje_comision": float,
        "comision_calculada": Decimal,
        "retenciones": Decimal,
        "comision_neta": Decimal,
    }],
    "totales": {
        "prima_total": Decimal,
        "comision_bruta": Decimal,
        "retenciones": Decimal,
        "comision_neta": Decimal,
    },
    "liquidacion": {
        "numero": str,
        "fecha": date,
        "estado": Literal["PENDIENTE", "PAGADA"],
        "fecha_pago": date | None,
        "referencia": str | None,
    },
}
```

---

#### 4.7. **EXTRACTOR DE DOCUMENTOS** ğŸ“‚

**Responsable de descargar y procesar TODOS los documentos:**

**Tipos de documentos:**
1. Documentos de cliente (DNI, permisos, etc.)
2. PÃ³lizas y condiciones
3. Suplementos
4. Certificados
5. Partes de siniestro
6. Fotos de daÃ±os
7. Presupuestos y facturas
8. Informes periciales
9. Informes mÃ©dicos
10. Atestados policiales
11. Justificantes de pago
12. Recibos
13. Comunicaciones

**Procesamiento:**
- Descarga paralela (10 documentos simultÃ¡neos)
- Almacenamiento en S3 con estructura organizada
- OCR automÃ¡tico de imÃ¡genes y PDFs escaneados
- ExtracciÃ³n de metadatos (fecha documento, tipo, emisor, etc.)
- ClasificaciÃ³n automÃ¡tica con ML
- IndexaciÃ³n en Elasticsearch para bÃºsqueda full-text
- GeneraciÃ³n de thumbnails para imÃ¡genes
- CompresiÃ³n inteligente
- DetecciÃ³n de duplicados (hash SHA256)

---

#### 4.8. **EXTRACTOR DE COMUNICACIONES** ğŸ’¬

**Datos a extraer:**

```python
ComunicacionCompleta = {
    "id": str,
    "fecha": datetime,
    "canal": Literal["EMAIL", "TELEFONO", "SMS", "WHATSAPP", "PRESENCIAL", "CORREO_POSTAL"],
    "direccion": Literal["ENTRANTE", "SALIENTE"],
    "remitente": {"tipo": Literal["CLIENTE", "MEDIADOR", "COMPAÃ‘IA"], "identificacion": str, "nombre": str},
    "destinatario": {"tipo": str, "identificacion": str, "nombre": str},
    "asunto": str | None,
    "contenido": str,
    "adjuntos": List[str],
    "relacionada_con": {
        "tipo": Literal["CLIENTE", "POLIZA", "SINIESTRO", "RECIBO"],
        "referencia": str,
    },
    "sentimiento": Literal["POSITIVO", "NEUTRO", "NEGATIVO"] | None,  # AnÃ¡lisis NLP
    "urgencia": Literal["BAJA", "MEDIA", "ALTA"] | None,
    "temas_detectados": List[str],  # ExtracciÃ³n automÃ¡tica con NLP
}
```

---

#### 4.9. **EXTRACTOR DE METADATOS Y ESTADÃSTICAS** ğŸ“Š

**Responsable de generar anÃ¡lisis agregados:**

- EstadÃ­sticas por cliente (volumen primas, siniestralidad, etc.)
- EstadÃ­sticas por pÃ³liza (renovaciones, suplementos, recibos impagados, etc.)
- EstadÃ­sticas por producto
- AnÃ¡lisis de cartera
- DetecciÃ³n de tendencias
- PredicciÃ³n de renovaciones
- SegmentaciÃ³n de clientes
- Scoring de riesgo

---

#### 4.10. **EXTRACTOR DE CAMBIOS (Diff Engine)** ğŸ”„

**Responsable de detectar cambios desde Ãºltima extracciÃ³n:**

**Funcionamiento:**
1. Calcular hash de cada entidad (cliente, pÃ³liza, siniestro, etc.)
2. Comparar con hash almacenado en BD
3. Si difiere, marcar como "MODIFICADO"
4. Extraer solo entidades modificadas
5. Generar evento de cambio con detalles:
   - QuÃ© cambiÃ³
   - Valores anteriores vs nuevos
   - QuiÃ©n lo cambiÃ³
   - CuÃ¡ndo
6. Notificar a sistemas interesados vÃ­a RabbitMQ

**Ventajas:**
- SincronizaciÃ³n incremental (mucho mÃ¡s rÃ¡pida)
- Historial completo de cambios
- DetecciÃ³n de anomalÃ­as
- AuditorÃ­a completa

---

#### 4.11. **EXTRACTOR DE APIS (Network Interceptor)** ğŸŒ

**TÃ©cnica avanzada: capturar llamadas API del portal**

**Â¿Por quÃ©?**
- Los portales modernos usan APIs REST/GraphQL
- Extraer datos directamente de JSON es mÃ¡s rÃ¡pido y confiable que parsear HTML
- Se obtienen datos que no siempre son visibles en UI

**ImplementaciÃ³n:**
```python
# Interceptar todas las requests/responses
page.on("request", lambda request: log_request(request))
page.on("response", lambda response: capture_api_response(response))

# Filtrar solo APIs de datos
if "/api/" in response.url() and response.status() == 200:
    try:
        data = await response.json()
        # Procesar datos JSON directamente
        save_api_data(data, response.url())
    except:
        pass
```

**Datos capturables:**
- Lista de clientes con paginaciÃ³n
- Detalles completos de pÃ³lizas (JSON completo)
- Siniestros con todos los campos
- Recibos
- BÃºsquedas
- Filtros y agregaciones

---

#### 4.12. **EXTRACTOR CON VISIÃ“N ARTIFICIAL (Computer Vision)** ğŸ‘ï¸

**Capacidades:**
- Detectar elementos en screenshots cuando selectores HTML fallan
- Leer textos con OCR (Tesseract + EasyOCR para mÃ¡xima precisiÃ³n)
- Detectar tablas y extraer datos estructurados
- Identificar tipos de documentos automÃ¡ticamente
- Detectar logos y marcas
- AnÃ¡lisis de fotos de siniestros:
  - Detectar daÃ±os en vehÃ­culos
  - Estimar severidad
  - Clasificar tipo de daÃ±o

**TecnologÃ­as:**
- OpenCV para procesamiento de imagen
- Tesseract OCR + EasyOCR (doble validaciÃ³n)
- YOLO para detecciÃ³n de objetos
- TensorFlow/PyTorch para modelos custom

---

#### 4.13. **EXTRACTOR CON NLP (Natural Language Processing)** ğŸ§ 

**Capacidades:**
- Extraer entidades nombradas (nombres, fechas, lugares, importes)
- Clasificar documentos automÃ¡ticamente
- Resumir textos largos (descripciones de siniestros, etc.)
- AnÃ¡lisis de sentimiento en comunicaciones
- ExtracciÃ³n de informaciÃ³n clave de PDFs no estructurados
- TraducciÃ³n automÃ¡tica si hay documentos en otros idiomas

**TecnologÃ­as:**
- spaCy con modelos en espaÃ±ol
- Transformers (BERT, RoBERTa)
- GPT-4 para tareas complejas

---

#### 4.14. **EXTRACTOR DE RELACIONES (Graph Builder)** ğŸ•¸ï¸

**Responsable de construir grafo de relaciones:**

**Tipos de relaciones:**
- Cliente â†’ CÃ³nyuge
- Cliente â†’ Hijos
- Cliente â†’ Socios
- Cliente â†’ Apoderados
- PÃ³liza â†’ Tomador / Asegurado / Pagador
- Siniestro â†’ Terceros implicados
- Cliente â†’ DirecciÃ³n â†’ Coordenadas (misma direcciÃ³n = posible relaciÃ³n)
- Cuenta bancaria compartida

**Almacenamiento:**
- Neo4j (graph database)
- Queries tipo: "Encontrar todos los clientes relacionados con NIF X"
- Detectar redes (fraude, familias, empresas relacionadas)

---

#### 4.15. **EXTRACTOR DE HISTÃ“RICO (Time-Series Collector)** â°

**Responsable de capturar datos histÃ³ricos:**

- Historial de modificaciones de pÃ³lizas
- EvoluciÃ³n de primas
- HistÃ³rico de siniestros
- Tendencias de pago
- Cambios de estado

**Almacenamiento:**
- ClickHouse (time-series optimizado)
- Grafana para visualizaciÃ³n

---

## 5. INTELIGENCIA ARTIFICIAL INTEGRADA {#ia-integrada}

### ğŸ¤– 30 Agentes Especializados

El scraper integra los **30 agentes IA** del ecosistema AIT-CORE:

#### Agentes de ExtracciÃ³n (8 agentes)

1. **Agent-01: Portal Navigator** ğŸ§­
   - Navega automÃ¡ticamente por el portal
   - Aprende la estructura
   - Genera selectores CSS dinÃ¡micamente
   - Se adapta a cambios de UI

2. **Agent-02: Data Extractor** ğŸ“Š
   - Identifica campos de datos automÃ¡ticamente
   - Valida y normaliza datos
   - Detecta campos nuevos

3. **Agent-03: Document Classifier** ğŸ“„
   - Clasifica documentos automÃ¡ticamente (DNI, pÃ³liza, factura, etc.)
   - Extrae metadatos
   - Organiza en estructura correcta

4. **Agent-04: OCR Specialist** ğŸ‘ï¸
   - Aplica OCR a imÃ¡genes y PDFs
   - Valida resultados con doble motor (Tesseract + EasyOCR)
   - Corrige errores comunes

5. **Agent-05: NLP Analyzer** ğŸ§ 
   - Extrae entidades de textos
   - Resume documentos largos
   - AnÃ¡lisis de sentimiento

6. **Agent-06: API Interceptor** ğŸŒ
   - Captura y analiza llamadas API
   - Construye catÃ¡logo de endpoints
   - Genera clientes API automÃ¡ticamente

7. **Agent-07: Change Detector** ğŸ”„
   - Detecta cambios en datos
   - Compara versiones
   - Genera eventos de cambio

8. **Agent-08: Relationship Builder** ğŸ•¸ï¸
   - Detecta relaciones entre entidades
   - Construye grafo de conocimiento
   - Infiere relaciones no explÃ­citas

#### Agentes de ValidaciÃ³n (5 agentes)

9. **Agent-09: Data Validator** âœ…
   - Valida formatos (NIFs, IBANs, emails, telÃ©fonos)
   - Detecta inconsistencias
   - Sugiere correcciones

10. **Agent-10: Anomaly Detector** ğŸš¨
    - Detecta datos anÃ³malos
    - Identifica posibles errores
    - Marca para revisiÃ³n manual

11. **Agent-11: Duplicate Detector** ğŸ”
    - Detecta duplicados
    - Fuzzy matching para variantes
    - Unifica registros

12. **Agent-12: Quality Assurance** ğŸ¯
    - Verifica completitud de datos
    - Calcula scores de calidad
    - Genera informes de calidad

13. **Agent-13: Fraud Detector** ğŸ›¡ï¸
    - Detecta patrones de fraude
    - AnÃ¡lisis de comportamiento
    - Scoring de riesgo

#### Agentes de Enriquecimiento (6 agentes)

14. **Agent-14: Data Enricher** ğŸ’
    - Enriquece datos con fuentes externas
    - GeolocalizaciÃ³n de direcciones
    - InformaciÃ³n de empresas (APIs pÃºblicas)

15. **Agent-15: Segmentation Engine** ğŸ“Š
    - Segmenta clientes automÃ¡ticamente
    - K-means clustering
    - Perfiles de cliente

16. **Agent-16: Scoring Engine** ğŸ¯
    - Calcula scores (riesgo, valor, propensiÃ³n)
    - Modelos predictivos
    - ML en tiempo real

17. **Agent-17: Recommendation Engine** ğŸ’¡
    - Recomienda productos
    - Cross-selling
    - Up-selling

18. **Agent-18: Churn Predictor** ğŸ“‰
    - Predice probabilidad de abandono
    - Detecta seÃ±ales tempranas
    - Sugiere acciones

19. **Agent-19: Lifetime Value Calculator** ğŸ’°
    - Calcula CLV (Customer Lifetime Value)
    - Proyecciones de ingresos
    - ROI de clientes

#### Agentes de AutomatizaciÃ³n (5 agentes)

20. **Agent-20: Task Automator** ğŸ¤–
    - Automatiza tareas repetitivas
    - Genera workflows
    - IntegraciÃ³n con n8n

21. **Agent-21: Error Recovery** ğŸ”§
    - Auto-recuperaciÃ³n de errores
    - Reintentos inteligentes
    - Aprende de errores

22. **Agent-22: Load Balancer** âš–ï¸
    - Distribuye carga entre workers
    - Optimiza recursos
    - Escalado automÃ¡tico

23. **Agent-23: Cache Optimizer** ğŸš€
    - Optimiza uso de cachÃ©
    - Predice necesidades
    - InvalidaciÃ³n inteligente

24. **Agent-24: Query Optimizer** âš¡
    - Optimiza consultas a BD
    - Genera Ã­ndices automÃ¡ticamente
    - Analiza planes de ejecuciÃ³n

#### Agentes de Monitoreo (6 agentes)

25. **Agent-25: Health Monitor** â¤ï¸
    - Monitorea salud del sistema
    - Detecta cuellos de botella
    - Alerta proactivamente

26. **Agent-26: Performance Analyzer** ğŸ“ˆ
    - Analiza performance
    - Identifica optimizaciones
    - Genera reportes

27. **Agent-27: Log Analyzer** ğŸ“
    - Analiza logs con NLP
    - Detecta patrones de error
    - Genera insights

28. **Agent-28: Security Monitor** ğŸ”’
    - Monitorea seguridad
    - Detecta intentos de acceso no autorizado
    - Compliance checker

29. **Agent-29: Cost Optimizer** ğŸ’¸
    - Optimiza costes de infra
    - Detecta recursos infrautilizados
    - Sugiere ahorros

30. **Agent-30: Report Generator** ğŸ“Š
    - Genera informes automÃ¡ticamente
    - Dashboards personalizados
    - EnvÃ­o programado

---

## 6. INTEGRACIÃ“N CON ECOSISTEMA AIT {#integracion-ait}

### ğŸ”— IntegraciÃ³n Total con AIT-CORE

```
SCRAPER OCCIDENT
       â”‚
       â”œâ”€â†’ AIT-DATAHUB (Almacenamiento)
       â”‚   â”œâ”€â”€ PostgreSQL (datos estructurados)
       â”‚   â”œâ”€â”€ MongoDB (logs)
       â”‚   â”œâ”€â”€ S3 (documentos)
       â”‚   â””â”€â”€ Elasticsearch (bÃºsqueda)
       â”‚
       â”œâ”€â†’ AIT-NERVE (OrquestaciÃ³n)
       â”‚   â”œâ”€â”€ GestiÃ³n de workers
       â”‚   â”œâ”€â”€ Scheduling
       â”‚   â””â”€â”€ Event bus
       â”‚
       â”œâ”€â†’ AIT-AUTHENTICATOR (Seguridad)
       â”‚   â”œâ”€â”€ GestiÃ³n de credenciales
       â”‚   â”œâ”€â”€ Vault integration
       â”‚   â””â”€â”€ Rotation de passwords
       â”‚
       â”œâ”€â†’ AIT-QB (Consultas)
       â”‚   â””â”€â”€ Query builder para datos extraÃ­dos
       â”‚
       â”œâ”€â†’ AIT-ENGINES (Procesamiento)
       â”‚   â”œâ”€â”€ Motor de reglas
       â”‚   â”œâ”€â”€ Workflows
       â”‚   â””â”€â”€ 30 agentes IA
       â”‚
       â”œâ”€â†’ AI-SUITE (PresentaciÃ³n)
       â”‚   â”œâ”€â”€ CRM con datos actualizados
       â”‚   â”œâ”€â”€ Dashboards
       â”‚   â””â”€â”€ Alertas
       â”‚
       â””â”€â†’ ERP CORE (IntegraciÃ³n total)
           â”œâ”€â”€ MÃ³dulo de Seguros actualizado
           â”œâ”€â”€ MÃ³dulo de Clientes
           â”œâ”€â”€ MÃ³dulo de Documentos
           â””â”€â”€ MÃ³dulo de Comisiones
```

### ğŸ“¡ Eventos Publicados

El scraper publica eventos a RabbitMQ:

```typescript
// Evento: Cliente extraÃ­do
{
  "event": "occident.cliente.extraido",
  "timestamp": "2026-01-28T10:30:00Z",
  "data": {
    "nif": "12345678A",
    "campos_extraidos": 52,
    "campos_nuevos": ["campo_x", "campo_y"],
    "documentos_descargados": 8,
    "polizas": 3,
    "siniestros": 1,
    "url_s3": "s3://bucket/clientes/12345678A/"
  }
}

// Evento: Cambio detectado
{
  "event": "occident.cambio.detectado",
  "timestamp": "2026-01-28T10:31:00Z",
  "data": {
    "tipo": "poliza",
    "numero_poliza": "POL-123456",
    "cambios": [
      {"campo": "prima_total", "anterior": 500.00, "nuevo": 550.00},
      {"campo": "estado", "anterior": "ACTIVA", "nuevo": "SUSPENDIDA"}
    ]
  }
}
```

### ğŸ›ï¸ APIs Expuestas

```typescript
// GET /api/scraper/status
{
  "status": "RUNNING",
  "workers_activos": 5,
  "clientes_en_cola": 120,
  "clientes_procesados_hoy": 350,
  "velocidad_actual": "85 clientes/hora",
  "tiempo_estimado_finalizacion": "1h 25min"
}

// POST /api/scraper/extract
{
  "nifs": ["12345678A", "87654321B"],
  "profundidad": "COMPLETA",
  "prioridad": "ALTA"
}

// GET /api/scraper/cliente/{nif}
// Devuelve datos completos extraÃ­dos

// GET /api/scraper/diff/{nif}
// Devuelve cambios desde Ãºltima extracciÃ³n

// POST /api/scraper/schedule
{
  "frecuencia": "*/5 * * * *",  // Cada 5 minutos
  "clientes": "TODOS" | ["NIF1", "NIF2"]
}
```

---

## 7. TRAZABILIDAD Y MONITOREO {#trazabilidad}

### ğŸ“Š Sistema de Trazabilidad Ultra-Completo

**Capas de trazabilidad:**

#### 1. Trazabilidad de EjecuciÃ³n

```typescript
EjecucionTrace = {
  executionId: string,
  startedAt: DateTime,
  endedAt: DateTime | null,
  status: "RUNNING" | "COMPLETED" | "FAILED",

  // Progreso
  totalClientes: number,
  clientesProcesados: number,
  clientesExitosos: number,
  clientesFallidos: number,
  progresoPorcentaje: number,

  // Performance
  velocidadActual: number,  // clientes/hora
  velocidadMedia: number,
  tiempoMedio: number,  // segundos/cliente

  // Errores
  errores: Array<{
    timestamp: DateTime,
    cliente: string,
    error: string,
    stackTrace: string,
    reintento: number
  }>,

  // Recursos
  memoryUsage: number,
  cpuUsage: number,
  diskUsage: number,
  networkTraffic: number
}
```

#### 2. Trazabilidad de Cliente

```typescript
ClienteTrace = {
  nif: string,
  executionId: string,

  // Timeline completo
  timeline: Array<{
    timestamp: DateTime,
    action: string,  // "INICIANDO", "NAVEGANDO", "EXTRAYENDO", "DESCARGANDO", "GUARDANDO"
    location: string,  // URL o secciÃ³n
    duration: number,
    screenshot: string | null,
    metadata: any
  }>,

  // Breadcrumb
  breadcrumb: string[],  // ["Inicio", "Clientes", "Buscar", "Ficha Cliente", "PÃ³lizas"]

  // EstadÃ­sticas
  totalSteps: number,
  currentStep: number,
  stepsRemaining: number,
  progressPercentage: number,
  estimatedTimeRemaining: number,

  // Datos extraÃ­dos
  datosExtraidos: {
    campos: number,
    polizas: number,
    siniestros: number,
    recibos: number,
    documentos: number,
    totalBytes: number
  },

  // Calidad
  calidadScore: number,  // 0-100
  camposFaltantes: string[],
  advertencias: string[]
}
```

#### 3. Trazabilidad de Documento

```typescript
DocumentoTrace = {
  documentoId: string,
  clienteNif: string,

  // Metadatos de descarga
  urlOrigen: string,
  fechaDescarga: DateTime,
  tamanoBytes: number,
  hash: string,  // SHA-256

  // Procesamiento
  ocrAplicado: boolean,
  ocrDuration: number,
  ocrConfidence: number,
  textoExtraido: string | null,

  // ClasificaciÃ³n
  tipoDocumento: string,
  clasificacionConfianza: number,
  entidadesExtraidas: any[],

  // Almacenamiento
  s3Key: string,
  s3Bucket: string,
  elasticsearchId: string
}
```

#### 4. Trazabilidad de Datos

**Lineage completo:** cada dato sabe de dÃ³nde vino

```typescript
DataLineage = {
  campo: "email",
  valor: "cliente@example.com",

  // Origen
  fuenteOrigen: "Portal Occident",
  urlOrigen: "https://portal.../cliente/12345678A",
  seccionOrigen: "Datos de Contacto",
  selectorCSS: "input#email",

  // ExtracciÃ³n
  extractorId: "Agent-02",
  fechaExtraccion: DateTime,
  metodoExtraccion: "DOM" | "API" | "OCR" | "NLP",

  // ValidaciÃ³n
  validado: true,
  validadorId: "Agent-09",
  formatoEsperado: "email",

  // Transformaciones
  transformaciones: [
    {paso: 1, accion: "trim", antes: " cliente@example.com ", despues: "cliente@example.com"},
    {paso: 2, accion: "lowercase", antes: "Cliente@Example.com", despues: "cliente@example.com"}
  ],

  // HistÃ³rico
  cambios: [
    {fecha: "2026-01-15", valorAnterior: "old@example.com", valorNuevo: "cliente@example.com"}
  ]
}
```

### ğŸ“ˆ Dashboards en Tiempo Real

**Dashboard Principal:**
- Mapa de calor de actividad
- Clientes procesados en tiempo real (contador animado)
- GrÃ¡fico de velocidad (clientes/hora)
- GrÃ¡fico de errores
- Logs en vivo (streaming)
- Screenshots de navegadores activos (mosaico)
- MÃ©tricas de recursos (CPU, RAM, red)

**Dashboard de Cliente:**
- Timeline visual de navegaciÃ³n
- Progreso paso a paso
- Datos extraÃ­dos en tiempo real
- Documentos descargados (galerÃ­a)
- Alertas y advertencias

**Dashboard de Performance:**
- Tiempos de respuesta por secciÃ³n
- Cuellos de botella
- Comparativa con ejecuciones anteriores
- Predicciones ML (tiempo finalizaciÃ³n, etc.)

---

## 8. STACK TECNOLÃ“GICO {#stack}

### ğŸ› ï¸ TecnologÃ­as Core

**Backend:**
```yaml
Lenguaje: Python 3.12+
Framework: FastAPI (API REST)
Async: asyncio + uvloop (mÃ¡xima performance)
Scraping: Playwright (multi-browser)
OrquestaciÃ³n: Celery + RabbitMQ
Scheduling: APScheduler + Cron
```

**Frontend:**
```yaml
Framework: Next.js 14 (App Router)
UI: Shadcn/ui + Tailwind CSS
Real-time: Socket.IO
Charts: Recharts + D3.js
```

**Bases de Datos:**
```yaml
Relacional: PostgreSQL 16 (datos estructurados)
Documentos: MongoDB 7 (logs, datos no estructurados)
Cache: Redis 7 (cache, cola, pub/sub)
BÃºsqueda: Elasticsearch 8 (full-text search)
Time-series: ClickHouse (histÃ³ricos)
Grafo: Neo4j (relaciones)
Object Storage: S3 / MinIO (documentos)
```

**AI/ML:**
```yaml
LLMs: OpenAI GPT-4 + Groq Llama-3 (fallback)
NLP: spaCy + Transformers (BERT, RoBERTa)
OCR: Tesseract + EasyOCR
Vision: OpenCV + YOLO
ML: scikit-learn + XGBoost
```

**Infraestructura:**
```yaml
ContainerizaciÃ³n: Docker + Docker Compose
OrquestaciÃ³n: Kubernetes (producciÃ³n)
CI/CD: GitHub Actions
Monitoring: Prometheus + Grafana
Logging: ELK Stack (Elasticsearch + Logstash + Kibana)
Tracing: Jaeger
Secrets: HashiCorp Vault
```

### ğŸ“¦ Estructura del Proyecto

```
scraper-occident-quantum/
â”œâ”€â”€ backend/
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ core/
â”‚   â”‚   â”‚   â”œâ”€â”€ config.py
â”‚   â”‚   â”‚   â”œâ”€â”€ director.py  # Orquestador principal
â”‚   â”‚   â”‚   â””â”€â”€ browser_pool.py
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ extractors/
â”‚   â”‚   â”‚   â”œâ”€â”€ base.py
â”‚   â”‚   â”‚   â”œâ”€â”€ cliente_extractor.py
â”‚   â”‚   â”‚   â”œâ”€â”€ poliza_extractor.py
â”‚   â”‚   â”‚   â”œâ”€â”€ siniestro_extractor.py
â”‚   â”‚   â”‚   â”œâ”€â”€ recibo_extractor.py
â”‚   â”‚   â”‚   â”œâ”€â”€ comision_extractor.py
â”‚   â”‚   â”‚   â”œâ”€â”€ documento_extractor.py
â”‚   â”‚   â”‚   â”œâ”€â”€ comunicacion_extractor.py
â”‚   â”‚   â”‚   â””â”€â”€ api_interceptor.py
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ processors/
â”‚   â”‚   â”‚   â”œâ”€â”€ ocr_processor.py
â”‚   â”‚   â”‚   â”œâ”€â”€ nlp_processor.py
â”‚   â”‚   â”‚   â”œâ”€â”€ vision_processor.py
â”‚   â”‚   â”‚   â””â”€â”€ pdf_processor.py
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ agents/  # 30 agentes IA
â”‚   â”‚   â”‚   â”œâ”€â”€ agent_01_navigator.py
â”‚   â”‚   â”‚   â”œâ”€â”€ agent_02_extractor.py
â”‚   â”‚   â”‚   â””â”€â”€ ...
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ validators/
â”‚   â”‚   â”‚   â”œâ”€â”€ data_validator.py
â”‚   â”‚   â”‚   â”œâ”€â”€ format_validator.py
â”‚   â”‚   â”‚   â””â”€â”€ business_validator.py
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ storage/
â”‚   â”‚   â”‚   â”œâ”€â”€ postgres_manager.py
â”‚   â”‚   â”‚   â”œâ”€â”€ s3_manager.py
â”‚   â”‚   â”‚   â”œâ”€â”€ elasticsearch_manager.py
â”‚   â”‚   â”‚   â””â”€â”€ neo4j_manager.py
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ traceability/
â”‚   â”‚   â”‚   â”œâ”€â”€ tracer.py
â”‚   â”‚   â”‚   â”œâ”€â”€ logger.py
â”‚   â”‚   â”‚   â””â”€â”€ metrics.py
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ api/
â”‚   â”‚   â”‚   â”œâ”€â”€ routes/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ scraper.py
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ clientes.py
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ stats.py
â”‚   â”‚   â”‚   â””â”€â”€ websocket.py
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ models/  # Pydantic models
â”‚   â”‚       â”œâ”€â”€ cliente.py
â”‚   â”‚       â”œâ”€â”€ poliza.py
â”‚   â”‚       â””â”€â”€ ...
â”‚   â”‚
â”‚   â”œâ”€â”€ tests/
â”‚   â”œâ”€â”€ Dockerfile
â”‚   â””â”€â”€ requirements.txt
â”‚
â”œâ”€â”€ frontend/
â”‚   â”œâ”€â”€ app/
â”‚   â”‚   â”œâ”€â”€ page.tsx  # Dashboard principal
â”‚   â”‚   â”œâ”€â”€ clientes/
â”‚   â”‚   â”œâ”€â”€ executions/
â”‚   â”‚   â””â”€â”€ analytics/
â”‚   â”‚
â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”œâ”€â”€ TraceabilityViewer.tsx
â”‚   â”‚   â”œâ”€â”€ LiveLogs.tsx
â”‚   â”‚   â”œâ”€â”€ PerformanceCharts.tsx
â”‚   â”‚   â””â”€â”€ ...
â”‚   â”‚
â”‚   â””â”€â”€ lib/
â”‚       â””â”€â”€ websocket.ts
â”‚
â”œâ”€â”€ database/
â”‚   â”œâ”€â”€ prisma/
â”‚   â”‚   â””â”€â”€ schema.prisma  # Schemas completos
â”‚   â””â”€â”€ migrations/
â”‚
â”œâ”€â”€ docker-compose.yml
â”œâ”€â”€ k8s/  # Kubernetes manifests
â””â”€â”€ README.md
```

---

## 9. ROADMAP DE IMPLEMENTACIÃ“N {#roadmap}

### ğŸ“… Fases de Desarrollo

#### **FASE 1: FUNDAMENTOS (Semana 1-2)** âœ…

**Objetivo:** Arquitectura base funcional

- [ ] Setup del proyecto (estructura, Docker, etc.)
- [ ] ConfiguraciÃ³n de bases de datos
- [ ] Sistema de autenticaciÃ³n con portal
- [ ] Browser pool bÃ¡sico (Playwright)
- [ ] Extractor de clientes (versiÃ³n bÃ¡sica)
- [ ] Almacenamiento en PostgreSQL
- [ ] API REST bÃ¡sica
- [ ] Dashboard simple (listado de ejecuciones)

**Entregables:**
- Scraper bÃ¡sico funcional extrayendo datos de clientes
- API REST con endpoints bÃ¡sicos
- Dashboard mostrando ejecuciones

---

#### **FASE 2: EXTRACTORES COMPLETOS (Semana 3-4)** ğŸ”¨

**Objetivo:** Todos los extractores funcionando

- [ ] Extractor de pÃ³lizas completo
- [ ] Extractor de siniestros completo
- [ ] Extractor de recibos completo
- [ ] Extractor de comisiones completo
- [ ] Extractor de documentos (descarga bÃ¡sica)
- [ ] Sistema de validaciÃ³n con Pydantic
- [ ] IntegraciÃ³n con S3 para documentos
- [ ] Sistema de trazabilidad bÃ¡sico

**Entregables:**
- ExtracciÃ³n completa de todas las entidades
- ValidaciÃ³n de datos
- Almacenamiento organizado

---

#### **FASE 3: INTELIGENCIA AVANZADA (Semana 5-6)** ğŸ§ 

**Objetivo:** Capacidades de IA operativas

- [ ] Implementar 10 agentes IA prioritarios
- [ ] Sistema OCR para documentos
- [ ] NLP para extracciÃ³n de entidades
- [ ] Computer Vision para screenshots
- [ ] API Interceptor (captura de requests)
- [ ] ClasificaciÃ³n automÃ¡tica de documentos
- [ ] DetecciÃ³n de duplicados
- [ ] AnÃ¡lisis de sentimiento

**Entregables:**
- 10 agentes IA funcionando
- OCR operativo con 95%+ precisiÃ³n
- ClasificaciÃ³n automÃ¡tica de documentos

---

#### **FASE 4: OPTIMIZACIÃ“N Y PARALELIZACIÃ“N (Semana 7)** âš¡

**Objetivo:** MÃ¡xima velocidad

- [ ] Pool de navegadores (5-10 paralelos)
- [ ] Procesamiento paralelo con Celery
- [ ] Cache inteligente con Redis
- [ ] OptimizaciÃ³n de consultas SQL
- [ ] CompresiÃ³n y deduplicaciÃ³n
- [ ] Load balancing

**Entregables:**
- 500+ clientes/hora
- Uso eficiente de recursos

---

#### **FASE 5: DETECCIÃ“N DE CAMBIOS (Semana 8)** ğŸ”„

**Objetivo:** SincronizaciÃ³n incremental

- [ ] Sistema de hashing de entidades
- [ ] ComparaciÃ³n con BD
- [ ] Diff engine
- [ ] Eventos de cambio a RabbitMQ
- [ ] Notificaciones en tiempo real
- [ ] Historial de cambios

**Entregables:**
- SincronizaciÃ³n cada 5 minutos
- DetecciÃ³n de cambios en tiempo real

---

#### **FASE 6: AGENTES IA COMPLETOS (Semana 9-10)** ğŸ¤–

**Objetivo:** 30 agentes funcionando

- [ ] Implementar agentes restantes (11-30)
- [ ] Sistema de orquestaciÃ³n de agentes
- [ ] Machine Learning models
  - Fraud detection
  - Churn prediction
  - Customer segmentation
  - Scoring models
- [ ] IntegraciÃ³n con GPT-4
- [ ] Sistema de recomendaciones

**Entregables:**
- 30 agentes IA operativos
- Modelos ML entrenados

---

#### **FASE 7: INTEGRACIONES ECOSISTEMA (Semana 11)** ğŸ”—

**Objetivo:** IntegraciÃ³n total con AIT-CORE

- [ ] IntegraciÃ³n con AIT-DATAHUB
- [ ] IntegraciÃ³n con AIT-NERVE
- [ ] IntegraciÃ³n con AIT-AUTHENTICATOR
- [ ] Eventos a RabbitMQ
- [ ] APIs GraphQL
- [ ] Webhooks
- [ ] SincronizaciÃ³n bidireccional con ERP

**Entregables:**
- IntegraciÃ³n completa con ecosistema
- Flujo de datos automÃ¡tico

---

#### **FASE 8: DASHBOARDS Y MONITOREO (Semana 12)** ğŸ“Š

**Objetivo:** Observabilidad total

- [ ] Dashboard principal completo
- [ ] Dashboard de trazabilidad
- [ ] Dashboard de performance
- [ ] Dashboard de analytics
- [ ] Sistema de alertas
- [ ] Logs centralizados (ELK)
- [ ] MÃ©tricas con Prometheus
- [ ] Grafana dashboards

**Entregables:**
- Dashboards profesionales
- Monitoreo completo
- Alertas configuradas

---

#### **FASE 9: PRUEBAS Y OPTIMIZACIÃ“N (Semana 13)** ğŸ§ª

**Objetivo:** ProducciÃ³n-ready

- [ ] Tests unitarios (cobertura 80%+)
- [ ] Tests de integraciÃ³n
- [ ] Tests de carga
- [ ] Pruebas de stress
- [ ] OptimizaciÃ³n de performance
- [ ] Fixing de bugs
- [ ] DocumentaciÃ³n completa

**Entregables:**
- Sistema estable y testeado
- DocumentaciÃ³n completa

---

#### **FASE 10: DESPLIEGUE Y GO-LIVE (Semana 14)** ğŸš€

**Objetivo:** ProducciÃ³n

- [ ] Deploy en Kubernetes
- [ ] ConfiguraciÃ³n de dominios
- [ ] SSL/TLS
- [ ] Backup automÃ¡tico
- [ ] Disaster recovery
- [ ] Monitoring en producciÃ³n
- [ ] CapacitaciÃ³n de usuarios

**Entregables:**
- Sistema en producciÃ³n
- Usuarios capacitados
- DocumentaciÃ³n de operaciÃ³n

---

## 10. MÃ‰TRICAS DE Ã‰XITO

### ğŸ“Š KPIs del Proyecto

| KPI | Objetivo | MediciÃ³n |
|-----|----------|----------|
| **Velocidad de extracciÃ³n** | 500+ clientes/hora | Clientes procesados / tiempo |
| **PrecisiÃ³n de datos** | 99.5% | Datos validados / datos totales |
| **Completitud** | 95% campos | Campos llenos / campos totales |
| **Disponibilidad** | 99.9% | Uptime / Total time |
| **Tasa de error** | <0.1% | Errores / operaciones totales |
| **OCR Accuracy** | 99% | Caracteres correctos / totales |
| **Tiempo de sincronizaciÃ³n** | <5 min | Tiempo Ãºltima sync |
| **DetecciÃ³n de cambios** | Tiempo real | Latencia detecciÃ³n |
| **Cobertura de documentos** | 100% | Docs descargados / docs disponibles |
| **SatisfacciÃ³n de usuario** | 4.8/5 | Encuestas |

---

## 11. CONCLUSIÃ“N

Este **SCRAPER DEFINITIVO EXTRAORDINARIO** representa el **estado del arte** en extracciÃ³n de datos de portales web:

### ğŸ† Ventajas Competitivas

1. **Inteligencia Artificial Nativa**: 30 agentes especializados
2. **Auto-adaptaciÃ³n**: Aprende y se adapta a cambios del portal
3. **MÃ¡xima Velocidad**: 10x mÃ¡s rÃ¡pido que scrapers tradicionales
4. **ExtracciÃ³n Exhaustiva**: TODOS los datos, visibles y ocultos
5. **Trazabilidad Total**: Cada byte estÃ¡ documentado
6. **IntegraciÃ³n Completa**: Parte del ecosistema AIT-CORE
7. **ProducciÃ³n-Ready**: Escalable, robusto, monitoreado

### ğŸ¯ Impacto Esperado

- **Ahorro de tiempo**: 95% reducciÃ³n en entrada manual de datos
- **PrecisiÃ³n**: 99.5% vs 85-90% manual
- **Insights**: Descubrimiento automÃ¡tico de patrones
- **Compliance**: AuditorÃ­a completa
- **ROI**: RecuperaciÃ³n de inversiÃ³n en 3-4 meses

---

**Â¿Listo para construir el scraper mÃ¡s avanzado jamÃ¡s creado?** ğŸš€

**PrÃ³ximo paso:** Implementar FASE 1 - Fundamentos
